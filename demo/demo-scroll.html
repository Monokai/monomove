<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monomove - Smooth Scroll Demo</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --text: #ececec;
            --accent: #ff0055;
            --card-bg: #1a1a1a;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow-x: hidden;
            /* Native scrollbar remains, but we control painting */
            overflow-y: scroll; 
        }

        /* The container that actually moves */
        #scroll-content {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            will-change: transform;
            /* Force hardware acceleration */
            backface-visibility: hidden;
        }

        /* --- UI Elements --- */
        
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
            mix-blend-mode: difference;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--accent);
            width: 0%;
            z-index: 101;
        }

        section {
            height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid #222;
        }

        /* Hero Parallax */
        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .hero h1 {
            font-size: 8vw;
            line-height: 1;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            position: relative;
            z-index: 2;
        }

        .hero-bg {
            position: absolute;
            width: 60vw;
            height: 60vw;
            background: radial-gradient(circle, #222 0%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
        }

        /* Cards / Scale Effect */
        .cards-section {
            display: flex;
            gap: 40px;
            perspective: 1000px;
        }

        .card {
            width: 250px;
            height: 350px;
            background: var(--card-bg);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            /* Initial state for nice entry */
            opacity: 0; 
        }

        /* Skew / Velocity Text */
        .text-stream {
            display: flex;
            flex-direction: column;
            gap: 20px;
            font-size: 4vw;
            font-weight: 900;
            text-transform: uppercase;
            white-space: nowrap;
            color: transparent;
            -webkit-text-stroke: 1px var(--text);
            width: 100%;
            overflow: hidden;
        }

        .stream-line {
            display: block;
        }

        /* Footer */
        .footer {
            height: 50vh;
            background: var(--accent);
            color: black;
        }

        .circle-grow {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
        }

    </style>
    <script src="../dist/index.umd.js"></script>
</head>
<body>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progress"></div>

    <nav>
        <span>MONOMOVE</span>
        <span>DEMO</span>
    </nav>

    <!-- The Fixed Content Wrapper -->
    <div id="scroll-content">
        
        <!-- Section 1: Parallax -->
        <section class="hero">
            <div class="hero-bg" data-scroll-speed="0.2"></div>
            <h1 data-scroll-speed="0.8">Smooth</h1>
            <h1 data-scroll-speed="0.6" style="color: var(--accent)">Scrolling</h1>
            <h1 data-scroll-speed="0.4">Experience</h1>
        </section>

        <!-- Section 2: Cards Reveal -->
        <section class="cards-section">
            <div class="card anim-card">1</div>
            <div class="card anim-card" style="margin-top: 50px">2</div>
            <div class="card anim-card" style="margin-top: 100px">3</div>
        </section>

        <!-- Section 3: Skew on Scroll -->
        <section>
            <div class="text-stream">
                <div class="stream-line">Kinetic Typography</div>
                <div class="stream-line" style="align-self: flex-end">Reacts to Velocity</div>
                <div class="stream-line">Powered by Math</div>
                <div class="stream-line" style="align-self: center">Super Performance</div>
            </div>
        </section>

        <!-- Section 4: Circle Grow -->
        <section class="footer">
            <div class="circle-grow"></div>
        </section>
    </div>

    <script>
        const { smoothScroll, RenderLoop } = window.monomove;

        // --- Setup Virtual Scroll ---
        const content = document.getElementById('scroll-content');
        const progressBar = document.getElementById('progress');

        // 1. Initialize the Scroller
        // We aren't adding specific items in the constructor call here, 
        // we will add them individually below for clarity.
        const scroller = smoothScroll([], null, {}, {
            scrollDuration: 0.6, // The "heaviness" of the scroll (seconds)
        });

        // 2. Resize Handler to sync Body Height with Fixed Content
        function onResize() {
            document.body.style.height = content.getBoundingClientRect().height + 'px';
            scroller.resize(); // Tell monomove that dimensions changed
        }
        window.addEventListener('resize', onResize);
        onResize(); // Init

        // 3. The Main Render Loop (The "Translate3d Trick")
        let currentScroll = 0;
        
        RenderLoop.add(() => {
            // Get the smoothed scroll value from the library
            currentScroll = scroller.scroll;
            
            // Apply to the fixed container
            content.style.transform = `translate3d(0, ${-currentScroll}px, 0)`;

            // Update Progress Bar
            const maxScroll = document.body.scrollHeight - window.innerHeight;
            const p = Math.min(1, Math.max(0, currentScroll / maxScroll));
            progressBar.style.width = `${p * 100}%`;
        });

        // --- Add Interesting Animations ---

        // A. Parallax Elements
        // We select elements with data-scroll-speed and move them at different rates
        const parallaxEls = document.querySelectorAll('[data-scroll-speed]');
        scroller.add(Array.from(parallaxEls), (data) => {
            if (!data.isInView) return;

            const speed = parseFloat(data.item.dataset.scrollSpeed || 0.5);
            // Calculate offset based on how far the item is from the center of viewport
            const y = data.centerOffset * speed;
            
            data.item.style.transform = `translate3d(0, ${y}px, 0)`;
        });

        // B. Card Reveal (Scale + Opacity based on boxFactor)
        // boxFactor goes from 0 (bottom of screen) to 1 (top of screen)
        const cards = document.querySelectorAll('.anim-card');
        scroller.add(Array.from(cards), (data) => {
            // We only care about the entry phase (bottom to center)
            // Remap 0.0 (enter) -> 0.5 (center) to 0 -> 1 progress
            let progress = (data.boxFactor - 0.0) / 0.4;
            progress = Math.min(1, Math.max(0, progress));

            const scale = 0.5 + (0.5 * progress);
            const rotate = 15 - (15 * progress);
            
            data.item.style.opacity = progress;
            data.item.style.transform = `
                scale(${scale}) 
                rotateY(${rotate}deg)
            `;
        });

        // C. Skew Text based on Velocity
        // To get velocity, we need to track delta between frames
        const skewLines = document.querySelectorAll('.stream-line');
        let prevScroll = 0;

        scroller.add(Array.from(skewLines), (data) => {
            if (!data.isInView) return;

            // Calculate simple velocity
            const velocity = currentScroll - prevScroll;
            
            // Clamp skew to avoid craziness
            const skew = Math.max(-10, Math.min(10, velocity * 0.1));

            // Alternate direction for visual interest
            const dir = Array.from(skewLines).indexOf(data.item) % 2 === 0 ? 1 : -1;

            data.item.style.transform = `skewX(${skew * dir}deg)`;
        });

        // Update prevScroll at the end of the frame
        RenderLoop.add(() => {
            prevScroll = currentScroll;
        });

        // D. Footer Circle Expansion
        const circle = document.querySelector('.circle-grow');
        scroller.add(circle, (data) => {
            // As it enters view
            if(data.boxFactor > 0) {
                const scale = 1 + (data.boxFactor * 10);
                data.item.style.transform = `scale(${scale})`;
            }
        });

    </script>
</body>
</html>