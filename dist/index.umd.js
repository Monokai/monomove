!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).monomove={})}(this,(function(t){"use strict";const i={linear:[0,0,1,1],ease:[.25,.1,.25,1],easeIn:[.42,0,1,1],easeOut:[0,0,.58,1],easeInOut:[.42,0,.58,1],easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};class s{iterations=4;precision=1e-5;newtonRaphsonMinSlope=.001;subdivisionPrecision=1e-7;subdivisionIterations=10;_cacheSize=11;_cachedValueStepSize=0;_cachedValues=[0];_x1;_y1;_x2;_y2;_isPreComputed;static _calculate(t,i,s){return(((1-3*s+3*i)*t+(3*s-6*i))*t+3*i)*t}static _getSlope(t,i,s){return 3*(1-3*s+3*i)*t**2+2*(3*s-6*i)*t+3*i}constructor(t,s=0,e=0,o=0){if(this.cacheSize=this._cacheSize,"string"==typeof t){const s=i[t];if(s)this._x1=s[0],this._y1=s[1],this._x2=s[2],this._y2=s[3];else{const i=t.split(",");this._x1=Number(i[0]),this._y1=Number(i[1]),this._x2=Number(i[2]),this._y2=Number(i[3])}}else this._x1=t,this._y1=s,this._x2=e,this._y2=o;this._isPreComputed=!1}_binarySubdivide(t,i,e,o,n){let a,h,r=0;do{h=i+(e-i)/2,a=s._calculate(h,o,n)-t,a>0?e=h:i=h}while(Math.abs(a)>this.subdivisionPrecision&&++r<this.subdivisionIterations);return h}_newtonRaphson(t,i,e,o){let n=i;for(let i=0;i<this.iterations;++i){const i=s._getSlope(n,e,o);if(0===i)return n;const a=s._calculate(n,e,o)-t;if(Math.abs(a)<this.precision)return n;n-=a/i}return n}_preCompute(){this._cachedValues=new Array(this._cacheSize);for(let t=0;t<this._cacheSize;++t)this._cachedValues[t]=s._calculate(t*this._cachedValueStepSize,this._x1,this._x2);this._isPreComputed=!0}_getT(t){let i=0,e=1;const o=this._cacheSize-1;for(;e!==o&&this._cachedValues[e]<=t;++e)i+=this._cachedValueStepSize;--e;const n=i+(t-this._cachedValues[e])/(this._cachedValues[e+1]-this._cachedValues[e])*this._cachedValueStepSize,a=s._getSlope(n,this._x1,this._x2);return a>=this.newtonRaphsonMinSlope?this._newtonRaphson(t,n,this._x1,this._x2):0===a?n:this._binarySubdivide(t,i,i+this._cachedValueStepSize,this._x1,this._x2)}get(t){return this._isPreComputed||this._preCompute(),0===t?0:1===t?1:s._calculate(this._getT(t),this._y1,this._y2)}set cacheSize(t){this._cacheSize=t,this._cachedValueStepSize=1/(this._cacheSize-1),this._cachedValues=new Array(this._cacheSize),this._isPreComputed=!1}get cacheSize(){return this._cacheSize}}class e{static _tweens=[];static _easingCache=new Map;static _isUpdating=!1;static bezierIterations=null;static bezierCacheSize=null;static bezierPrecision=null;static bezierNewtonRaphsonMinSlope=null;static bezierSubdivisionPrecision=null;static bezierSubdivisionIterations=null;static getAll(){const t=[],i=this._tweens.length;for(let s=0;s<i;s++){const i=this._tweens[s];null!==i&&t.push(i)}return t}static removeAll(){const t=this._tweens.length;for(let i=0;i<t;i++)this._tweens[i]?.stop();this._tweens.length=0,this._easingCache.clear()}static add(t){this._tweens.push(t)}static remove(t){const i=this._tweens.indexOf(t);-1!==i&&(this._isUpdating?this._tweens[i]=null:this._tweens.splice(i,1))}static onTick(t){const i=this._tweens,s=i.length;if(0===s)return!1;this._isUpdating=!0;let e=0;for(let o=0;o<s;o++){const s=i[o];null!==s&&s.update(t)&&(o!==e&&(i[e]=s),e++)}this._isUpdating=!1;const o=i.length;if(o>s)for(let t=s;t<o;t++)i[e++]=i[t];return i.length=e,e>0}static getEasingFromCache(t){return this._easingCache.has(t)||this._easingCache.set(t,new s(t)),this._easingCache.get(t)}static setEasingOptions(t,i={}){const s={iterations:e.bezierIterations,cacheSize:e.bezierCacheSize,precision:e.bezierPrecision,newtonRaphsonMinSlope:e.bezierNewtonRaphsonMinSlope,subdivisionPrecision:e.bezierSubdivisionPrecision,subdivisionIterations:e.bezierSubdivisionIterations,...i},o=Object.keys(s);for(const i of o){const e=s[i];null!==e&&(t[i]=e)}}}const o="undefined"!=typeof window;class n{static _subscribers=[];static _isUpdating=!1;static _activeCount=0;static _ms=0;static _time=0;static _previousTime=0;static _pauseTime=0;static _pauseTimeStart=0;static _isAnimating=!1;static _requestAnimation=!1;static _requestID=0;static _isFirstTime=!0;static _loopHandler=n._animate.bind(n);static _animate(){if(!o)return;const t=window.performance.now();this._time=t-this._pauseTime,this._isFirstTime?(this._ms=0,this._isFirstTime=!1):this._ms=this._time-this._previousTime,this._ms<0&&(this._ms=0);const i=e.onTick(this._time),s=this._subscribers.length,n=this._subscribers;let a=0;this._isUpdating=!0;for(let t=0;t<s;t++){const i=n[t];null!==i&&!1!==i(this._ms)&&a++}this._isUpdating=!1,this._activeCount<n.length&&this._compact(),this._previousTime=this._time,this._isAnimating&&(a>0||i)?(this._requestID=window.requestAnimationFrame(this._loopHandler),this._requestAnimation=!0):this._requestAnimation=!1}static _compact(){let t=0;const i=this._subscribers.length,s=this._subscribers;for(let e=0;e<i;e++){const i=s[e];null!==i&&(e!==t&&(s[t]=i),t++)}s.length=t,this._activeCount=t}static stop(t){this._isAnimating=!1,o&&window.cancelAnimationFrame(this._requestID),this._requestAnimation=!1,t&&t()}static add(t){this._subscribers.push(t),this._activeCount++,this.trigger()}static reset(){this._subscribers.length=0,this._activeCount=0,e.removeAll(),this.stop(),this._ms=0,this._time=0,this._previousTime=0,this._pauseTime=0,this._pauseTimeStart=0,this._isAnimating=!1,this._requestAnimation=!1,this._requestID=0,this._isFirstTime=!0}static remove(t){const i=this._subscribers.indexOf(t);-1!==i&&(this._isUpdating?(this._subscribers[i]=null,this._activeCount--):(this._subscribers.splice(i,1),this._activeCount--)),this.trigger()}static trigger(){o&&!this._requestAnimation&&(this._isFirstTime||(this._previousTime=this.getTime()),this._requestAnimation=!0,this._requestID=window.requestAnimationFrame(this._loopHandler))}static getTime(){return o?window.performance.now()-this._pauseTime:0}static pause(){this._isAnimating&&o&&(this._pauseTimeStart=window.performance.now(),this._requestAnimation=!1,this._isAnimating=!1,window.cancelAnimationFrame(this._requestID))}static play(){!this._isAnimating&&o&&(this._isFirstTime||(this._pauseTime+=window.performance.now()-this._pauseTimeStart),this.triggerAnimation())}static triggerAnimation(){this._isAnimating=!0,this.trigger()}static isPlaying(){return this._isAnimating}}class a{durationMS;isPlaying;delayTime;startTime;easingFunction;progress;totalTime;onTimelineInCallback=null;onTimelineOutCallback=null;onTimelineVisibleCallback=null;onTimelineInvisibleCallback=null;isTimelineIn=!1;isPreviousTimelineIn=!1;isTimelineVisible=!1;isPreviousTimelineVisible=!1;_objectOrValue;_onUpdateCallback;_onLoopCallback;_onCompleteCallback;_onStartCallback;_valuesEnd;_valuesStart;_propKeys;_propStartValues;_propChangeValues;_loopNum;_loopCount;_onStartCallbackFired;_previousTime;_elapsed;_previousUpdateValue;_inverseDuration;_targetIsFunction;_startValuesCalculated=!1;constructor(t,i=1){this.durationMS=1e3*i,this._inverseDuration=this.durationMS>0?1/this.durationMS:0,this.easingFunction=t=>t,this.progress=0,this.delayTime=0,this.isPlaying=!1,this.startTime=null,this._loopNum=0,this._loopCount=0,this._onLoopCallback=null,this._onCompleteCallback=null,this._onStartCallback=null,this._onStartCallbackFired=!1,this._previousTime=null,this._elapsed=0,this._previousUpdateValue=null,this._valuesStart={},this._propKeys=[],this._propStartValues=[],this._propChangeValues=[],this._startValuesCalculated=!1,void 0===t?(this._targetIsFunction=!0,this._objectOrValue=0,this._onUpdateCallback=null,this._valuesStart.value=0,this._valuesEnd={value:1}):"function"==typeof t?(this._targetIsFunction=!0,this._objectOrValue=0,this._onUpdateCallback=t,this._valuesStart.value=0,this._valuesEnd={value:1}):(this._targetIsFunction=!1,this._objectOrValue=t,this._onUpdateCallback=null,this._valuesEnd={})}from(t){if("object"==typeof t&&null!==t&&this._targetIsFunction&&null===this._onUpdateCallback&&0===this._objectOrValue&&(this._targetIsFunction=!1,this._objectOrValue={},this._valuesStart={},this._valuesEnd={}),"number"==typeof t)this._valuesStart.value=t;else if(this._targetIsFunction){const i=t,s=Object.keys(i);for(const t of s){const s=i[t];"number"==typeof s&&(this._valuesStart[t]=s)}}else{const i=t;for(const t in i){const s=i[t];"number"==typeof s&&(this._valuesStart[t]=s)}}return this._startValuesCalculated=!1,this}to(t,i){return void 0!==i&&(this.durationMS=1e3*i,this._inverseDuration=this.durationMS>0?1/this.durationMS:0),"object"==typeof t&&null!==t&&this._targetIsFunction&&null===this._onUpdateCallback&&0===this._objectOrValue&&(this._targetIsFunction=!1,this._objectOrValue={},this._valuesStart={},this._valuesEnd={}),"number"==typeof t?this._valuesEnd.value=t:this._valuesEnd={...this._valuesEnd,...t},this._startValuesCalculated=!1,this}duration(t){return this.durationMS=1e3*t,this._inverseDuration=this.durationMS>0?1/this.durationMS:0,this}rewind(){return this.stop(),this.progress=0,this._elapsed=0,this._previousUpdateValue=null,this._startValuesCalculated&&this.setProgress(0),this}restart(){return this.rewind(),this.start()}loop(t=1/0){return this._loopNum=t,this._loopCount=t,this}onLoop(t){return this._onLoopCallback=t,this}delay(t){return this.delayTime=1e3*t,this}easing(t=(t=>t),i){if(!t)return this;if("string"==typeof t){const s=e.getEasingFromCache(t);i&&e.setEasingOptions(s,i),this.easingFunction=s.get.bind(s)}else if("object"==typeof t&&null!==t&&"get"in t){const s=t;i&&e.setEasingOptions(s,i),this.easingFunction=s.get.bind(s)}else this.easingFunction=t;return this}onUpdate(t){return this._onUpdateCallback=t,this}onStart(t){return this._onStartCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onTimelineIn(t){return this.onTimelineInCallback=()=>t(this._objectOrValue),this}onTimelineOut(t){return this.onTimelineOutCallback=()=>t(this._objectOrValue),this}onTimelineVisible(t){return this.onTimelineVisibleCallback=()=>t(this._objectOrValue),this}onTimelineInvisible(t){return this.onTimelineInvisibleCallback=()=>t(this._objectOrValue),this}start(t){const i=this._onCompleteCallback;return new Promise((s=>{this._onCompleteCallback=t=>{i?.(t),this._onCompleteCallback=i,s(this)},this.startTween(t)}))}startTween(t=n.getTime()){const i=this.isPlaying;return this._elapsed=0,this._onStartCallbackFired=!1,this.isPlaying=!0,this.startTime=t+this.delayTime,0===this.durationMS&&0===this._loopNum&&0===this.delayTime?(this.update(t),this.isPlaying=!1):i||(e.add(this),n.triggerAnimation()),this}stop(){return this.isPlaying?(this.isPlaying=!1,e.remove(this),this):this}pause(){return this.stop()}_calculateStartValues(){if(this._startValuesCalculated)return;this._propKeys.length=0,this._propStartValues.length=0,this._propChangeValues.length=0;const t=this._objectOrValue;if(this._targetIsFunction){const t=this._valuesStart.value??0,i=this._valuesEnd.value??1;this._propKeys.push("value"),this._propStartValues.push(t),this._propChangeValues.push(i-t)}else if(t){const i=this._valuesEnd;for(const s in i){const e=i[s];if(void 0===e)continue;let o;if(void 0!==this._valuesStart[s])o=this._valuesStart[s];else{const i=t[s];o="number"==typeof i?i:0}this._propKeys.push(s),this._propStartValues.push(o),this._propChangeValues.push(e-o)}}this._startValuesCalculated=!0}updateAllValues(t=0){if(this._startValuesCalculated||this._calculateStartValues(),this._targetIsFunction){if(this._propStartValues.length>0){const i=this._propStartValues[0]+this._propChangeValues[0]*this.progress;this._onUpdateCallback&&this._onUpdateCallback(i,this.progress,t)}return}const i=this._propKeys.length,s=this._propKeys,e=this._propStartValues,o=this._propChangeValues,n=this._objectOrValue;for(let t=0;t<i;t++)n[s[t]]=e[t]+o[t]*this.progress;this._onUpdateCallback&&this._objectOrValue&&this._onUpdateCallback(this._objectOrValue,this.progress,t)}setProgress(t,i=!1){this._startValuesCalculated||this._calculateStartValues();const s=t<0?0:t>1?1:t;!i&&null!==this._previousUpdateValue&&Math.abs(s-this._previousUpdateValue)<1e-6||(this.progress=this.easingFunction(s),this.updateAllValues(),this._previousUpdateValue=s)}invalidate(){this._previousUpdateValue=null,this._startValuesCalculated=!1}update(t){if(null===this.startTime||t<this.startTime)return!0;this._startValuesCalculated||this._calculateStartValues(),!1===this._onStartCallbackFired&&(this._onStartCallback?.(this._objectOrValue),this._onStartCallbackFired=!0,n.trigger()),this._elapsed=t-this.startTime;const i=0===this.durationMS?1:this._elapsed*this._inverseDuration,s=i>1?1:i;this.progress=this.easingFunction(s),null===this._previousTime&&(this._previousTime=t);const e=t-this._previousTime;if(this._previousTime=t,this.updateAllValues(e),1===s){const s=this.startTime;if(0===this.durationMS)return this.isPlaying&&this._onCompleteCallback?.(this._objectOrValue),this.isPlaying=!1,!1;if(this._loopCount>0)return this._onLoopCallback?.(this._objectOrValue,this._loopNum-this._loopCount),this._loopCount--,this.startTime+=this.durationMS,this._elapsed=t-this.startTime,!0;this.isPlaying&&this._onCompleteCallback?.(this._objectOrValue);const e=s!==this.startTime;return this.isPlaying=e||this.isPlaying&&i<1,this.isPlaying}return!0}}function h(t,i,s=Number.MAX_VALUE){return t<i?i:t>s?s:t}class r{time=0;totalTime=0;isPlaying=!1;_items=[];_delayTime;_loopCount=0;_onComplete;_onLoop;_isDirty=!0;_driver=null;_easing="linear";_timeScale=1;constructor({delay:t=0,onComplete:i,onLoop:s}={}){this._delayTime=1e3*t,this._onComplete=i,this._onLoop=s}add(t,i=0){const s=this._items.length>0?this._items[this._items.length-1].endTime:0,e=Math.max(0,s+1e3*i);return this._register(t,e),this}at(t,i){return this._register(i,1e3*t),this}_register(t,i){const s=void 0!==t.totalTime?t.totalTime:t.durationMS;this._items.push({tween:t,startTime:i,endTime:i+s,duration:s}),this.totalTime=Math.max(this.totalTime,i+s),this._isDirty=!0}delay(t){return this._delayTime=1e3*t,this}loop(t=1/0){return this._loopCount=t,this}easing(t){return this._easing=t,this}timeScale(t){return this._timeScale=t,this._driver&&this.isPlaying&&this.stop().start(),this}async start(){this._isDirty&&this._sort(),this.stop(),this.isPlaying=!0;const t=this._timeScale<0,i=t?this.totalTime:0,s=t?0:this.totalTime;return this._driver=d().from(i).to(s).duration(this.totalTime/1e3/Math.abs(this._timeScale)).onUpdate((t=>{this.time=t,this._updateChildren(this.time,!1)})).easing(this._easing).delay(this._delayTime/1e3).loop(this._loopCount).onLoop((()=>{this._onLoop?.(),this._updateChildren(t?this.totalTime:0,!0)})).onComplete((()=>{this.isPlaying=!1,this._onComplete?.()})),this._driver.start().then((()=>this))}pause(){return this.isPlaying=!1,this._driver?.stop(),this}stop(){return this.pause(),this._driver=null,this.time=this._timeScale<0?this.totalTime:0,this._updateChildren(this.time,!0),this}setPosition(t,i=!1){this.isPlaying&&this.pause(),this._isDirty&&this._sort(),this.time=h(t,0,this.totalTime),this._updateChildren(this.time,i)}setProgress(t){this.setPosition(h(t,0,1)*this.totalTime)}_sort(){this._items.sort(((t,i)=>t.startTime-i.startTime)),this._isDirty=!1}_updateChildren(t,i){const s=this._items.length;for(let e=s-1;e>=0;e--){const s=this._items[e];if(t<s.startTime){const t=s.tween,e=t.isTimelineVisible;(t.progress>0||e||i)&&(t.setProgress(0,!0),i&&t.invalidate(),r.setTweenVisibility(t,!1))}}for(let e=0;e<s;e++){const s=this._items[e],{tween:o,startTime:n,endTime:a,duration:h}=s;if(t<n)continue;if(t>=a){if(1!==o.progress||i){const t=o.progress;o.setProgress(1,!0),r.setTweenVisibility(o,!0),t<1&&1===o.progress&&o.onTimelineOutCallback?.()}continue}const l=0===h?1:(t-n)/h,c=o.progress;o.setProgress(l,!0),r.setTweenVisibility(o,!0),0===c&&o.progress>0&&o.onTimelineInCallback?.(),c<1&&1===o.progress&&o.onTimelineOutCallback?.()}}static setTweenVisibility(t,i){t.isTimelineVisible=i,t.isTimelineVisible!==t.isPreviousTimelineVisible&&(i?t.onTimelineVisibleCallback?.():t.onTimelineInvisibleCallback?.(),t.isPreviousTimelineVisible=t.isTimelineVisible)}}class l{element;smoothing;observer;_box;_data;_hasEnteredOnce=!1;_hasExitedOnce=!1;_previousIsInView=!1;_previousFactor=NaN;_directionOffset;_offset;_speed;_onUpdate;_onScrolledIn;_onScrolledOut;_onScrolledInOnce;_onScrolledOutOnce;_smoothScrollFn;constructor(t,i,s,e,o=null){this.element=t,this.observer=o,this._directionOffset=s.directionOffset||0,this._offset=s.offset||0,this._speed=s.speed||1,this.smoothing=s.smoothing||0,e?this._onUpdate=e:s.onUpdate&&(this._onUpdate=s.onUpdate),this._onScrolledIn=s.onScrolledIn,this._onScrolledOut=s.onScrolledOut,this._onScrolledInOnce=s.onScrolledInOnce,this._onScrolledOutOnce=s.onScrolledOutOnce,this._box={left:0,top:0,width:0,height:0},this._data={item:t,factor:0,rawFactor:0,rawBoxFactor:0,boxFactor:0,box:this._box,scroll:0,smoothScrollValue:0,isInView:!1,boxIsInView:!1,index:i,centerOffset:0,originalTop:0,isVisible:!0,data:s.data}}setVisible(t){this._data.isVisible=t}get isVisible(){return this._data.isVisible}getData(){return this._data}resize(t,i){const s=this.element.getBoundingClientRect(),e=window.scrollX||window.pageXOffset;this._box.left=s.left+e,this._box.top=s.top+t,this._box.width=s.width,this._box.height=s.height,this._data.centerOffset=.5*(i-this._box.height),this._data.originalTop=this._box.top,this._data.scroll=this._data.smoothScrollValue}update(t,i,s,e=!1,o=16.6){const n=this._box;if(0===n.height)return;if(this._data.scroll=t,this.smoothing&&this._smoothScrollFn){const i=60*o/1e3;this._data.smoothScrollValue=this._smoothScrollFn(t,i,this.smoothing)}else this._data.smoothScrollValue=t;const a=this._directionOffset*(s?-1:1),h=n.top+n.height-this._data.smoothScrollValue+a*i+this._offset*i,r=h/(i+n.height),l=(h-i)/n.height,c=this._speed;this._data.rawFactor=(1-r-.5)*c+.5,this._data.rawBoxFactor=(1-l-.5)*c+.5,this._data.factor=this._data.rawFactor<0?0:this._data.rawFactor>1?1:this._data.rawFactor,this._data.boxFactor=this._data.rawBoxFactor<0?0:this._data.rawBoxFactor>1?1:this._data.rawBoxFactor,this._data.isInView=this._data.rawFactor>=0&&this._data.rawFactor<=1,this._data.boxIsInView=this._data.rawBoxFactor>=0&&this._data.rawBoxFactor<=1,this._data.isInView!==this._previousIsInView&&(this._data.isInView?(this.smoothing&&(this._smoothScrollFn=((t=0)=>(i,s=0,e=.95)=>i+(t-i)*e**s)(t)),this._onScrolledIn?.(this._data),this._hasEnteredOnce||(this._hasEnteredOnce=!0,this._onScrolledInOnce?.(this._data))):(this._onScrolledOut?.(this._data),this._smoothScrollFn=void 0,this._hasExitedOnce||(this._hasExitedOnce=!0,this._onScrolledOutOnce?.(this._data))),this._previousIsInView=this._data.isInView),this._onUpdate&&(this._previousFactor!==this._data.factor||e)&&(this._onUpdate(this._data),this._previousFactor=this._data.factor)}}let c=!1;if("undefined"!=typeof window)try{const t=Object.defineProperty({},"passive",{get:()=>(c=!0,!0)});window.addEventListener("test",(()=>{}),t),window.removeEventListener("test",(()=>{}),t)}catch{}const _=!!c&&{passive:!0};class u{isDown=!1;isLocked=!1;scroll=0;scrollWidth=0;scrollHeight=0;_pixelRatio=1;_scrollThreshold=.01;_targetScroll=0;_previousScroll=0;_viewportHeight=0;_items=[];_activeItems=new Set;_smoothItems=new Set;_debugCanvas=null;_debugContext=null;_isAnimating=!1;_previousScrollWidth=0;_previousScrollHeight=0;_isFirstScrollInstant=!0;_isTouch=!1;_scrollTween=new a({y:0}).easing("0.35,0.15,0,1").onUpdate((t=>{window.scrollTo(0,t.y),this._isAnimating=!0,this.scroll=t.y,this._targetScroll=t.y,this.isDown=this._targetScroll>=this._previousScroll,this._previousScroll=this._targetScroll}));_touchScrollDuration=0;_scrollDuration=0;_container;_content;_listener;_debug=!1;_onResizeFunk=null;_totalTickTime=0;_scrollFrom=0;_easing;_getScrollPosition;_onTickFunk=this._onTick.bind(this);_onTouchStart=()=>{this.isLocked||(this._isTouch=!0)};_onMouseDown=t=>{t.stopPropagation(),this.isLocked||(this._isTouch=!1)};_onWheel=()=>{this.isLocked||(this._scrollTween.stop(),this._isTouch=!1)};_onScroll=()=>{if(this.isLocked)return;this._isAnimating=!0;const t=Math.max(0,this.scrollHeight-this._viewportHeight),i=this._getScrollPosition();this._targetScroll=i<0?0:i>t?t:i,this._scrollFrom=this.scroll,this._totalTickTime=0};constructor({container:t=window.document.body,content:i=window.document.body,easing:s=(t=>Math.min(1,1.001-2**(-10*t))),scrollDuration:e=0,listener:o=window,debug:a=!1,onResize:h}={}){if(this._scrollDuration=e||0,this._container=t,this._content=i,this._listener=o,this._debug=a,this._easing=s,this._onResizeFunk=h||null,"scrollY"in this._listener)this._getScrollPosition=()=>this._listener.scrollY;else if("pageYOffset"in this._listener)this._getScrollPosition=()=>this._listener.pageYOffset;else{const t=this._listener;this._getScrollPosition=()=>t.scrollTop}this._setupListeners(),this._setupDebug(),n.add(this._onTickFunk),n.play(),this.resize()}_setupListeners(){if(!this._listener)return;const t=_,i=this._listener;i.addEventListener("touchstart",this._onTouchStart,t),i.addEventListener("scroll",this._onScroll,t),i.addEventListener("mousedown",this._onMouseDown,t),i.addEventListener("wheel",this._onWheel,t)}_setupDebug(){this._debug&&this._container&&(this._debugCanvas=document.createElement("canvas"),this._container.appendChild(this._debugCanvas))}_onTick(t){if(this.isLocked)return!0;const i=this._content.scrollWidth,s=this._content.scrollHeight;if(i!==this.scrollWidth||s!==this.scrollHeight)return this.scrollWidth=i,this.scrollHeight=s,i===this._previousScrollWidth&&s===this._previousScrollHeight||this.resize(),this._previousScrollWidth=i,this._previousScrollHeight=s,this.scroll=this._scrollFrom=this._targetScroll,this._updateAll(this.scroll,t),!0;if(this._smoothItems.size>0)for(const i of this._smoothItems){if(this._activeItems.has(i)&&this._isAnimating)continue;const s=i.getData();Math.abs(s.smoothScrollValue-this.scroll)>this._scrollThreshold&&i.update(this.scroll,this._viewportHeight,this.isDown,!1,t)}if(!this._isAnimating){const t=this._getScrollPosition();Math.abs(t-this.scroll)>1&&(this._isAnimating=!0,this._targetScroll=t,this._scrollFrom=this.scroll,this._totalTickTime=0)}if(!this._isAnimating)return!0;const e=this._targetScroll-this.scroll;if(Math.abs(e)<this._scrollThreshold)return this.scroll=this._targetScroll,this._updateAll(this.scroll,t),this._isTouch&&this.triggerAnimations(!0),this._isAnimating=!1,!0;this._totalTickTime+=t/1e3;const o=this._isTouch?this._touchScrollDuration:this._scrollDuration,n=0===o?1:h(this._totalTickTime/o,0,1),a=this._easing(n);if(this.scroll=this._scrollFrom+(this._targetScroll-this._scrollFrom)*a,this._isFirstScrollInstant){this._isFirstScrollInstant=!1,this.scroll=this._scrollFrom=this._targetScroll;const t=this.isDown;this.isDown=!0,this.triggerAnimations(!0),this.isDown=!1,this.triggerAnimations(!0),this.isDown=t}return this._updateAll(this.scroll,t),!0}_updateAll(t,i=16.6){if(this.isDown=t>=this._previousScroll,this._previousScroll=t,this._activeItems.size>0)for(const t of this._activeItems)t.update(this.scroll,this._viewportHeight,this.isDown,!1,i);this._debugContext&&this._drawDebug()}draw(){this._updateAll(this.scroll)}drawAll(){for(const t of this._items)t.update(this.scroll,this._viewportHeight,this.isDown,!0)}getScrollPosition(){return this._getScrollPosition()}resize(){if(!this._container||!this._content)return;this.scroll=this._scrollFrom=this._previousScroll=this._targetScroll,this.scrollHeight=this._content.scrollHeight,this._viewportHeight=window.innerHeight,this._pixelRatio=window.devicePixelRatio;const t=window.scrollY||window.pageYOffset;for(let i=0;i<this._items.length;i++)this._items[i].resize(t,this._viewportHeight);if(this._debugCanvas){const t=window.innerWidth,i=window.innerHeight,s=this._pixelRatio;this._debugCanvas.width=t*s,this._debugCanvas.height=i*s,Object.assign(this._debugCanvas.style,{position:"fixed",left:"0",top:"0",width:`${t}px`,height:`${i}px`,pointerEvents:"none",zIndex:"9999999"}),this._debugContext=this._debugCanvas.getContext("2d")}this._onResizeFunk&&this._onResizeFunk(),this._refreshActiveSets()}triggerAnimations(t=!1){if(t){const t=this._items.length;for(let i=0;i<t;i++)this._items[i].update(this.scroll,this._viewportHeight,this.isDown,!0)}else for(const t of this._activeItems)t.update(this.scroll,this._viewportHeight,this.isDown,!0);this._debugContext&&this._drawDebug()}_drawDebug(){if(!this._debugContext||!this._debugCanvas)return;const t=this._debugContext;t.clearRect(0,0,this._debugCanvas.width,this._debugCanvas.height),t.strokeStyle="#f00",t.lineWidth=2*this._pixelRatio,t.beginPath();const i=this._pixelRatio,s=this._viewportHeight;for(const e of this._activeItems){const o=e.getData(),n=o.box.top-o.scroll;n+o.box.height>=0&&n<=s&&t.rect(o.box.left*i,n*i,o.box.width*i,o.box.height*i)}t.stroke()}add(t,i,s={}){const e=Array.isArray(t)?t:[t];let o,n;"function"==typeof i?(o=i,n=s):(n=i||{},o=void 0);const a=!!window.IntersectionObserver,h=void 0===n.observeIn?null:n.observeIn,r=n.directionOffset||0,c=n.offset||0,_=n.speed||1,u=`${r?100*r:1/_*100}% 0% ${r?100*r:c?100*c:1/_*100}% 0%`;let d=null;a&&(d=new window.IntersectionObserver((t=>{for(const i of t){const t=i.target,s=this._items.find((i=>i.element===t));if(s){const t=i.isIntersecting;s.setVisible(t),t&&!s.smoothing?this._activeItems.add(s):t||s.smoothing||this._activeItems.delete(s),s.update(this.scroll,this._viewportHeight,this.isDown)}}}),{root:h,rootMargin:u,threshold:0}));const p=window.scrollY||window.pageYOffset;for(let t=0;t<e.length;t++){const i=e[t],s=new l(i,t,n,o,d);s.resize(p,this._viewportHeight),d?(d.observe(i),s.setVisible(!1)):(this._activeItems.add(s),s.update(this.scroll,this._viewportHeight,this.isDown,!0)),s.smoothing&&this._smoothItems.add(s),this._items.push(s)}}_refreshActiveSets(){this._activeItems.clear(),this._smoothItems.clear();for(const t of this._items)t.smoothing&&this._smoothItems.add(t),t.isVisible&&!t.smoothing&&this._activeItems.add(t)}remove(t){const i=Array.isArray(t)?t:[t],s=new Set(i),e=[];for(const t of this._items)s.has(t.element)?(t.observer?.unobserve(t.element),this._activeItems.delete(t),this._smoothItems.delete(t)):e.push(t);this._items=e}static getBox(t){const i=t.getBoundingClientRect(),s=window.scrollY||window.pageYOffset,e=window.scrollX||window.pageXOffset;return{left:i.left+e,top:i.top+s,width:i.width,height:i.height}}scrollTo(t=0,i=null){const s=Math.abs(t-this.scroll),e=i??h(25e-5*s,.25,2.5);return this._scrollTween.from({y:this.scroll}).to({y:t},e).start()}scrollToElement(t,i=0,s=null){const e=u.getBox(t);return this.scrollTo(e.top+i,s)}reset(){for(const t of this._items)t.observer?.unobserve(t.element);this._items.length=0,this._activeItems.clear(),this._smoothItems.clear(),this._viewportHeight=0}stop(){this._isAnimating=!1,this._scrollTween.stop()}lock(){this.isLocked=!0}unlock(){this.isLocked=!1,window.scrollTo(0,this.scroll)}setContent(t){this._content=t,this.resize()}unsetContent(){this._content=null}setScrollDuration(t){this._scrollDuration=t}setTouchScrollDuration(t){this._touchScrollDuration=t}destroy(){if(this._debugCanvas?.remove(),this._listener){const t=this._listener,i=_;t.removeEventListener("touchstart",this._onTouchStart,i),t.removeEventListener("wheel",this._onWheel,i),t.removeEventListener("mousedown",this._onMouseDown,i),t.removeEventListener("scroll",this._onScroll,i)}this.reset(),this.stop(),n.remove(this._onTickFunk)}}function d(t,i=1){return new a(t,i)}t.CubicBezier=s,t.RenderLoop=n,t.SmoothScroller=u,t.Timeline=r,t.Tween=a,t.TweenManager=e,t.animate=function(t,i,s=1,e="linear"){return d(t,s).to(i).easing(e).start()},t.delay=async t=>d().duration(t).start(),t.smoothScroll=function(t,i,s={},e={}){const o=new u(e);return o.add(t,i,s),o},t.timeline=function(t){return new r(t)},t.tween=d,Object.defineProperty(t,"__esModule",{value:!0})}));
