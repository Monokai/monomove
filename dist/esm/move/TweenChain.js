import e from"./AbstractTimeline.js";import t from"../math/clamp.js";class i extends e{constructor(e,t){super(t),this.tweens=e.reduce(((e,t,i)=>this.addTween(e,t,0===i?this.delay:0)),[]),this.totalTime=this.tweens.reduce(((e,t)=>e+(t.totalTime?t.totalTime:t.delayTime+t.durationMS)),0)}addTween(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t instanceof this.constructor)for(let i=0;i<t.tweens.length;i++){const s=t.tweens[i];this.addTween(e,s,0===i?t.delay:0)}else i&&(t.delayTime+=1e3*i),e.push(t);return e}setPosition(e){const s=t(e,0,1)*this.totalTime;let n=this.totalTime;for(let e=this.tweens.length-1;e>=0;e--){const t=this.tweens[e];if(void 0!==t.totalTime){const e=t.totalTime;n-=1e3*t.delay+e,n+1e3*t.delay>s&&t.setPosition(0)}else{const e=t.durationMS;if(n-=t.delayTime+e,!(n+t.delayTime>s))break;t.value=0,i.setTweenVisibility(t,!1),i.setTweenIn(t,!1),t.invalidate(),t.updateAllValues()}}n=0;for(let e=0;e<this.tweens.length;e++){const l=this.tweens[e];if(void 0!==l.totalTime){const e=l.totalTime,i=1e3*l.delay+e,o=n+1e3*l.delay;if(n+=i,n<=s)l.setPosition(1);else{if(!(o<=s))break;{const i=t((s-o)/e,0,1);l.setPosition(i)}}}else{const e=l.durationMS,o=l.delayTime+e,a=n+l.delayTime;if(n+=o,n<=s)l.value=1,i.setTweenVisibility(l,!0),i.setTweenIn(l,!1);else{if(!(a<=s))break;{const n=t((s-a)/e,0,1);l.value=l.easingFunction(n),i.setTweenVisibility(l,!0),i.setTweenIn(l,!0)}}l.invalidate(),l.updateAllValues()}}}update(){this.setPosition(this.previousPosition||0)}}export{i as default};
