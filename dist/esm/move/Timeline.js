import e from"./AbstractTimeline.js";import t from"../math/clamp.js";class i extends e{constructor(e,t){super(t),this.tweens=e.reduce(((e,t)=>this.#e(e,t,this.delay)),[]).sort(((e,t)=>e.delayTime-t.delayTime)),this.totalTime=this.tweens.reduce(((e,t)=>Math.max(e,t.totalTime?t.totalTime:t.delayTime+t.durationMS)),0)}#e(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t instanceof this.constructor?t.tweens.forEach((s=>this.#e(e,s,i+t.delay))):(i&&(t.delayTime+=1e3*i),e.push(t)),e}setPosition(e){const s=t(e,0,1)*this.totalTime;for(let e=this.tweens.length-1;e>=0;e--){const t=this.tweens[e];if(void 0!==t.totalTime)1e3*t.delay>s&&t.setPosition(0);else{if(!(t.delayTime>s))break;t.value=0,i.setTweenVisibility(t,!1),i.setTweenIn(t,!1),t.invalidate(),t.updateAllValues()}}for(let e=0;e<this.tweens.length;e++){const a=this.tweens[e];if(void 0!==a.totalTime){const e=a.totalTime,i=1e3*a.delay+e,n=1e3*a.delay;if(i<=s)a.setPosition(1);else{if(!(n<=s))break;{const i=t((s-n)/e,0,1);a.setPosition(i)}}}else{const e=a.durationMS,n=a.delayTime+e,o=a.delayTime;if(n<=s)a.value=1,i.setTweenVisibility(a,!0),i.setTweenIn(a,!1);else{if(!(o<=s))break;{const n=t((s-o)/e,0,1);a.value=a.easingFunction(n),i.setTweenVisibility(a,!0),i.setTweenIn(a,!0)}}a.invalidate(),a.updateAllValues()}}this.previousPosition=e}update(){this.setPosition(this.previousPosition||0)}}export{i as default};
