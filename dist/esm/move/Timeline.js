import e from"./AbstractTimeline.js";import i from"../math/clamp.js";class s extends e{constructor(e,t){super(t),this.tweens=e.reduce(((e,t)=>this.addTween(e,t,this.delay)),[]).sort(((e,t)=>e.delayTime-t.delayTime)),this.totalTime=this.tweens.reduce(((e,t)=>Math.max(e,t.totalTime?t.totalTime:t.delayTime+t.durationMS)),0)}addTween(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t instanceof this.constructor?t.tweens.forEach((s=>this.addTween(e,s,i+t.delay))):(i&&(t.delayTime+=1e3*i),e.push(t)),e}setPosition(e){const a=i(e,0,1)*this.totalTime;for(let e=this.tweens.length-1;e>=0;e--){const t=this.tweens[e];if(void 0!==t.totalTime)1e3*t.delay>a&&t.setPosition(0);else{if(!(t.delayTime>a))break;t.value=0,s.setTweenVisibility(t,!1),s.setTweenIn(t,!1),t.invalidate(),t.updateAllValues()}}for(let e=0;e<this.tweens.length;e++){const n=this.tweens[e];if(void 0!==n.totalTime){const e=n.totalTime,s=1e3*n.delay+e,o=t+1e3*n.delay;if(s<=a)n.setPosition(1);else{if(!(o<=a))break;{const t=i((a-o)/e,0,1);n.setPosition(t)}}}else{const e=n.durationMS,t=n.delayTime+e,o=n.delayTime;if(t<=a)n.value=1,s.setTweenVisibility(n,!0),s.setTweenIn(n,!1);else{if(!(o<=a))break;{const t=i((a-o)/e,0,1);n.value=n.easingFunction(t),s.setTweenVisibility(n,!0),s.setTweenIn(n,!0)}}n.invalidate(),n.updateAllValues()}}this.previousPosition=e}update(){this.setPosition(this.previousPosition||0)}}export{s as default};
