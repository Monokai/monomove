import{classPrivateMethodInitSpec as t,defineProperty as i,classPrivateFieldInitSpec as e,classPrivateFieldSet as s,classPrivateFieldGet as o,classPrivateMethodGet as h}from"../_virtual/_rollupPluginBabelHelpers.js";import l from"../math/clamp.js";import n from"./RenderLoop.js";import r from"./Tween.js";let a=!1;try{const t=Object.defineProperty({},"passive",{get:()=>(a=!0,!0)});window.addEventListener("a",null,t),window.removeEventListener("a",null,t)}catch(t){}var c=new WeakMap,d=new WeakMap,w=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,v=new WeakMap,g=new WeakMap,b=new WeakMap,m=new WeakMap,k=new WeakMap,O=new WeakMap,W=new WeakMap,x=new WeakMap,M=new WeakMap,I=new WeakMap,S=new WeakMap,y=new WeakMap,L=new WeakMap,E=new WeakMap,F=new WeakMap,P=new WeakMap,T=new WeakMap,H=new WeakMap,j=new WeakMap,V=new WeakMap,B=new WeakMap,A=new WeakSet,D=new WeakSet,R=new WeakSet,C=new WeakSet;class z{constructor(){let{container:z=window.document.body,content:$=window.document.body,scrollFactor:G=1,listener:_=window,debug:U=!1,onResize:X}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,C),t(this,R),t(this,D),t(this,A),i(this,"isDown",!1),i(this,"isLocked",!1),i(this,"scroll",0),i(this,"scrollHeight",0),e(this,c,{writable:!0,value:.01}),e(this,d,{writable:!0,value:1}),e(this,w,{writable:!0,value:0}),e(this,u,{writable:!0,value:0}),e(this,p,{writable:!0,value:0}),e(this,f,{writable:!0,value:[]}),e(this,v,{writable:!0,value:null}),e(this,g,{writable:!0,value:null}),e(this,b,{writable:!0,value:null}),e(this,m,{writable:!0,value:!1}),e(this,k,{writable:!0,value:0}),e(this,O,{writable:!0,value:0}),e(this,W,{writable:!0,value:null}),e(this,x,{writable:!0,value:null}),e(this,M,{writable:!0,value:null}),e(this,I,{writable:!0,value:null}),e(this,S,{writable:!0,value:!0}),e(this,y,{writable:!0,value:!1}),e(this,L,{writable:!0,value:!1}),e(this,E,{writable:!0,value:(new r).easing("0.35,0.15,0,1").onUpdate((t=>{window.scrollTo(0,t.y),s(this,m,!0),this.scroll=t.y,s(this,w,t.y),this.isDown=o(this,w)>=o(this,u),s(this,u,o(this,w))})).onStart((()=>{s(this,L,!0)})).onComplete((()=>{s(this,L,!1)}))}),e(this,F,{writable:!0,value:!!a&&{passive:!0}}),e(this,P,{writable:!0,value:null}),e(this,T,{writable:!0,value:null}),e(this,H,{writable:!0,value:null}),e(this,j,{writable:!0,value:null}),e(this,V,{writable:!0,value:null}),e(this,B,{writable:!0,value:null}),s(this,P,G),s(this,T,z),s(this,H,$),s(this,j,_),s(this,V,U),s(this,B,X),s(this,W,(()=>{this.isLocked||s(this,y,!0)})),s(this,x,(()=>{this.isLocked||(s(this,m,!0),s(this,w,l(this.getScrollPosition(),0,Math.round(this.scrollHeight-o(this,p)))))})),s(this,I,(t=>{t.stopPropagation(),this.isLocked||s(this,y,!1)})),s(this,M,(()=>{this.isLocked||(o(this,E)&&o(this,E).stop(),s(this,y,!1),s(this,L,!1))})),o(this,j)&&(o(this,V),o(this,j).addEventListener("touchstart",o(this,W),o(this,F)),o(this,j).addEventListener("scroll",o(this,x),o(this,F)),o(this,j).addEventListener("mousedown",o(this,I),o(this,F)),o(this,j).addEventListener("wheel",o(this,M),o(this,F))),o(this,V)&&(s(this,g,window.document.createElement("canvas")),o(this,T).appendChild(o(this,g))),n.add(this,h(this,A,Y)),n.play(),this.resize()}draw(){h(this,D,$).call(this)}drawAll(){const t=o(this,v);s(this,v,o(this,f)),h(this,D,$).call(this),s(this,v,t)}getScrollPosition(){return void 0!==o(this,j).scrollY?o(this,j).scrollY:void 0!==o(this,j).pageYOffset?o(this,j).pageYOffset:void 0!==o(this,j).scrollTop?o(this,j).scrollTop:0}resize(){o(this,T)&&o(this,H)&&(this.scroll=s(this,u,o(this,w)),this.scrollHeight=o(this,H).scrollHeight,s(this,p,window.innerHeight),o(this,f).forEach((t=>{h(this,C,_).call(this,t)})),o(this,g)&&(o(this,g).width=window.innerWidth*window.devicePixelRatio,o(this,g).height=window.innerHeight*window.devicePixelRatio,o(this,g).style.position="fixed",o(this,g).style.left=0,o(this,g).style.top=0,o(this,g).style.width=`${window.innerWidth}px`,o(this,g).style.height=`${window.innerHeight}px`,o(this,g).style.pointerEvents="none",o(this,g).style.zIndex=9999999,s(this,b,o(this,g).getContext("2d"))),o(this,B)&&o(this,B).call(this),h(this,R,G).call(this))}triggerAnimations(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i=window.devicePixelRatio;o(this,b)&&(o(this,b).clearRect(0,0,o(this,g).width,o(this,g).height),o(this,b).strokeStyle="#f00",o(this,b).lineWidth=2*i,o(this,b).beginPath()),o(this,t?f:v).forEach((t=>{const e=t.box;if(!e||!e.width||!e.height)return;const s=t.animationObject;s.scroll=this.scroll;const h=t.directionOffset||0,n=t.offset||0,r=e.top+e.height-s.scroll+h*(this.isDown?-1:1)*o(this,p)+n*o(this,p),a=r/(o(this,p)+e.height),c=(r-o(this,p))/e.height;s.rawFactor=(1-a-.5)*t.speed+.5,s.rawBoxFactor=(1-c-.5)*t.speed+.5,s.factor=l(s.rawFactor,0,1),s.isInView=s.rawFactor>=0&&s.rawFactor<=1,s.boxFactor=l(s.rawBoxFactor,0,1),s.boxIsInView=s.rawBoxFactor>=0&&s.rawBoxFactor<=1,s.box=e,s.item=t.item,s.fixedTop&&(s.box.top=s.fixedTop),s.isInView!==s.previousIsInView&&(s.isInView?(s.isScrolledIn=!0,void 0===s.isScrolledInOnce&&(s.isScrolledInOnce=!0)):void 0!==s.previousIsInView&&(s.isScrolledOut=!0,void 0===s.isScrolledOutOnce&&(s.isScrolledOutOnce=!0))),t.animation&&t.previousFactor!==s.factor&&(t.animation(s),t.previousFactor=s.factor),s.isScrolledIn=!1,s.isScrolledOut=!1,!0===s.isScrolledInOnce&&(s.isScrolledInOnce=!1),!0===s.isScrolledOutOnce&&(s.isScrolledOutOnce=!1),s.previousIsInView=s.isInView,o(this,b)&&s.box.top+s.box.height-s.scroll>=0&&s.box.top-s.scroll<=o(this,p)&&o(this,b).rect(s.box.left*i,s.box.top*i-s.scroll*i,s.box.width*i,s.box.height*i)})),o(this,b)&&o(this,b).stroke()}add(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=t&&t instanceof Array?t:[t];void 0===e.observeIn&&(e.observeIn=null),l.forEach((t=>{const l={centerOffset:0,originalTop:0,isVisible:!0};let n=null;window.IntersectionObserver&&void 0!==e.observeIn?(n=new window.IntersectionObserver((t=>{t.forEach((t=>{l.isVisible=t.isIntersecting,h(this,R,G).call(this)}))}),{root:e.observeIn,rootMargin:`${e.directionOffset?100*e.directionOffset:e.speed?1/e.speed*100:0}% 0% ${e.directionOffset?100*e.directionOffset:e.offset?100*e.offset:e.speed?1/e.speed*100:0}% 0%`,threshold:0}),n.observe(t)):s(this,v,null);const r={animation:i,directionOffset:e.directionOffset||0,offset:e.offset||0,speed:void 0===e.speed?1:e.speed,animationObject:l,item:t,observer:n};h(this,C,_).call(this,r),o(this,f).push(r)}))}remove(t){const i=t&&t instanceof Array?t:[t];s(this,f,o(this,f).filter((t=>i.indexOf(t.item)<0)))}static getBox(t){let i=t,e=0,s=0;do{if(void 0===i.offsetLeft){const t=i.getBoundingClientRect(),o=window.document.documentElement;e+=t.left+window.pageXOffset-o.clientLeft,s+=t.top+window.pageYOffset-o.clientTop}else e+=i.offsetLeft,s+=i.offsetTop;i=i.offsetParent}while(i);if(void 0===t.offsetWidth){const i=t.getBoundingClientRect();return{left:e,top:s,width:i.width,height:i.height}}return{left:e,top:s,width:t.offsetWidth,height:t.offsetHeight}}scrollTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,E).from({y:this.scroll}).to({y:t},i??l(25e-5*Math.abs(t-this.scroll),.25,2.5)).start()}scrollToElement(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=z.getBox(t);return this.scrollTo(s.top,i,e)}reset(){o(this,f).length=0,s(this,p,0)}stop(){s(this,m,!1)}lock(){this.isLocked=!0}unlock(){this.isLocked=!1,window.scrollTo(0,this.scroll)}setContent(t){s(this,H,t),this.resize()}unsetContent(){s(this,H,null)}setScrollFactor(t){s(this,P,t)}setTouchScrollFactor(t){s(this,d,t)}destroy(){o(this,V)&&o(this,g).remove(),o(this,j)&&(o(this,V),o(this,j).removeEventListener("touchstart",o(this,W),o(this,F)),o(this,j).removeEventListener("wheel",o(this,M),o(this,F)),o(this,j).removeEventListener("mousedown",o(this,I),o(this,F)),o(this,j).removeEventListener("scroll",o(this,x),o(this,F))),this.reset(),this.stop()}}function Y(){if(this.isLocked)return!0;if(this.scrollHeight=o(this,H)?o(this,H).scrollHeight:0,this.scrollHeight!==o(this,O))return this.resize(),this.scroll=o(this,w),h(this,D,$).call(this,this.scroll),s(this,O,this.scrollHeight),!0;if(!o(this,m))return!0;const t=(o(this,w)-this.scroll)*(o(this,y)?o(this,d):o(this,P));if(Math.abs(t)<o(this,c)&&(o(this,y)&&this.triggerAnimations(!0),s(this,m,!1)),this.scroll+=t,o(this,S)){s(this,S,!1),this.scroll=o(this,w),o(this,V);const t=this.isDown;this.isDown=!0,this.triggerAnimations(!0),this.isDown=!1,this.triggerAnimations(!0),this.isDown=t}return null===o(this,v)&&s(this,v,o(this,f)),h(this,D,$).call(this,this.scroll),!0}function $(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isDown=t>=o(this,u),o(this,v)&&(this.triggerAnimations(),s(this,u,t))}function G(){s(this,v,o(this,f).filter((t=>t.animationObject.isVisible))),o(this,V)}function _(t){t.box=z.getBox(t.item),t.animationObject.centerOffset=.5*(o(this,p)-t.box.height),t.animationObject.originalTop=t.box.top,t.animationObject.scroll=t.animationObject.targetScroll=o(this,w)}export{z as default};
