import{classPrivateMethodInitSpec as i,defineProperty as t,classPrivateFieldInitSpec as e,classPrivateFieldSet as s,classPrivateFieldGet as l,classPrivateMethodGet as h}from"../_virtual/_rollupPluginBabelHelpers.js";import a from"./RenderLoop.js";import n from"./TweenManager.js";var r=new WeakMap,o=new WeakMap,u=new WeakMap,c=new WeakMap,v=new WeakMap,d=new WeakMap,b=new WeakMap,m=new WeakMap,g=new WeakMap,p=new WeakMap,w=new WeakMap,T=new WeakMap,k=new WeakMap,M=new WeakSet,y=new WeakSet;class j{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(this,y),i(this,M),t(this,"durationMS",null),t(this,"isPlaying",null),t(this,"delayTime",null),t(this,"startTime",null),t(this,"easingFunction",null),t(this,"object",null),t(this,"value",null),t(this,"onTimelineInCallback",null),t(this,"onTimelineOutCallback",null),t(this,"onTimelineVisibleCallback",null),t(this,"onTimelineInvisibleCallback",null),e(this,r,{writable:!0,value:void 0}),e(this,o,{writable:!0,value:void 0}),e(this,u,{writable:!0,value:void 0}),e(this,c,{writable:!0,value:void 0}),e(this,v,{writable:!0,value:void 0}),e(this,d,{writable:!0,value:void 0}),e(this,b,{writable:!0,value:void 0}),e(this,m,{writable:!0,value:void 0}),e(this,g,{writable:!0,value:void 0}),e(this,p,{writable:!0,value:void 0}),e(this,w,{writable:!0,value:void 0}),e(this,T,{writable:!0,value:void 0}),e(this,k,{writable:!0,value:void 0}),"function"==typeof h&&void 0!==a?(this.object={value:0},s(this,r,h),s(this,o,{value:1}),this.durationMS=1e3*a,s(this,T,{value:0}),s(this,u,["value",l(this,o).value])):(this.object=h,s(this,o,{}),s(this,r,null),this.durationMS=1e3,s(this,T,{}),s(this,u,[])),s(this,c,0),s(this,v,0),s(this,d,null),s(this,b,null),s(this,m,null),s(this,g,!1),this.onTimelineInCallback=null,this.onTimelineOutCallback=null,this.onTimelineVisibleCallback=null,this.onTimelineInvisibleCallback=null,s(this,p,null),s(this,w,0),s(this,k,null),this.easingFunction=i=>i,this.value=0,this.delayTime=0,this.isPlaying=!1,this.startTime=null,Object.keys(this.object).forEach((i=>{l(this,T)[i]=this.object[i]}))}from(i){return Object.keys(i).forEach((t=>{this.object[t]=i[t]})),null!==l(this,r)&&l(this,r).call(this,this.object,this.value,0),this}to(i,t){return void 0!==t&&(this.durationMS=1e3*t),s(this,o,i),l(this,u).length=0,this}duration(i){return this.durationMS=1e3*i,this}rewind(){return Object.keys(this.object).forEach((i=>{this.object[i]=l(this,T)[i]})),this.value=this.easingFunction(0),this}restart(){return this.rewind().start()}loop(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return s(this,c,i),s(this,v,i),this}startTween(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.getTime();const t=this.isPlaying;return s(this,w,0),s(this,g,!1),this.isPlaying=!0,this.startTime=i+this.delayTime,0===l(this,u).length&&Object.keys(l(this,o)).forEach((i=>{l(this,T)[i]=this.object[i],l(this,u).push(i,l(this,o)[i])})),0===this.durationMS&&0===l(this,c)&&0===this.delayTime?(this.update(i),this.isPlaying=!1):t||(n.add(this),a.play()),this}start(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];const h=l(this,b);return new Promise((i=>{s(this,b,(()=>{h&&h(),s(this,b,h),i(this)})),this.startTween(...t)}))}stop(){return this.isPlaying?(this.isPlaying=!1,n.remove(this),this):this}delay(i){return this.delayTime=1e3*i,this}easing(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i=>i,{iterations:t=n.bezierIterations,cacheSize:e=n.bezierCacheSize}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i;return s?("string"==typeof s&&(s=n.getEasingFromCache(s),t&&s.setIterations(t),e&&s.setCacheSize(e)),s.get?this.easingFunction=s.get.bind(s):this.easingFunction=s,this):this}onStart(i){return s(this,m,i),this}onUpdate(i){return s(this,r,i),this}onComplete(){return s(this,b,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this}onTimelineIn(i){return this.onTimelineInCallback=i,this}onTimelineOut(i){return this.onTimelineOutCallback=i,this}onTimelineVisible(i){return this.onTimelineVisibleCallback=i,this}onTimelineInvisible(i){return this.onTimelineInvisibleCallback=i,this}updateAllValues(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.value!==l(this,k)){for(let i=0;i<l(this,u).length;i+=2)h(this,y,f).call(this,l(this,u)[i],l(this,u)[i+1]);null!==l(this,r)&&l(this,r).call(this,this.object,this.value,i),s(this,k,this.value)}}invalidate(){return s(this,k,null),this}update(i){if(i<this.startTime)return!0;!1===l(this,g)&&(null!==l(this,m)&&l(this,m).call(this,this.object),s(this,g,!0),a.trigger()),s(this,w,i-this.startTime);const t=0===this.durationMS?1:Math.min(l(this,w)/this.durationMS,1);this.value=this.easingFunction(t),null===l(this,p)&&s(this,p,i);const e=i-l(this,p);if(s(this,p,i),this.updateAllValues(e),1===t){const t=this.startTime;var h;return l(this,v)>0?(l(this,d)&&l(this,d).call(this,this.object,l(this,c)-l(this,v)),s(this,v,(h=l(this,v),--h)),this.restart()):l(this,b)&&this.isPlaying&&l(this,b).call(this,this.object,i-this.startTime),this.isPlaying=!(t===this.startTime),!1}return!0}}function f(i,t){const e=l(this,T)[i];this.object[i]=e+(t-e)*this.value}export{j as default};
