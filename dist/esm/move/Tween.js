import t from"./RenderLoop.js";import i from"./TweenManager.js";class e{durationMS=null;isPlaying=null;delayTime=null;startTime=null;easingFunction=null;object=null;value=null;onTimelineInCallback=null;onTimelineOutCallback=null;onTimelineVisibleCallback=null;onTimelineInvisibleCallback=null;#t;#i;#e;#s;#l;#a;#n;#o;#h;#u;#r;#c;#b;constructor(t={},i=1){"function"==typeof t&&void 0!==i?(this.object={value:0},this.#t=t,this.#i={value:1},this.durationMS=1e3*i,this.#c={value:0},this.#e=["value",this.#i.value]):(this.object=t,this.#i={},this.#t=null,this.durationMS=1e3,this.#c={},this.#e=[]),this.easingFunction=t=>t,this.value=0,this.delayTime=0,this.isPlaying=!1,this.startTime=null,this.onTimelineInCallback=null,this.onTimelineOutCallback=null,this.onTimelineVisibleCallback=null,this.onTimelineInvisibleCallback=null,this.#s=0,this.#l=0,this.#a=null,this.#n=null,this.#o=null,this.#h=!1,this.#u=null,this.#r=0,this.#b=null,Object.keys(this.object).forEach((t=>{this.#c[t]=this.object[t]}))}from(t){return Object.keys(t).forEach((i=>{this.object[i]=t[i]})),null!==this.#t&&this.#t(this.object,this.value,0),this}to(t,i){return void 0!==i&&(this.durationMS=1e3*i),this.#i=t,this.#e.length=0,this}duration(t){return this.durationMS=1e3*t,this}rewind(){return Object.keys(this.object).forEach((t=>{this.object[t]=this.#c[t]})),this.value=this.easingFunction(0),this}restart(){return this.rewind().start()}loop(t=1/0){return this.#s=t,this.#l=t,this}#d(t){return this.#a=t,this}startTween(e=t.getTime()){const s=this.isPlaying;return this.#r=0,this.#h=!1,this.isPlaying=!0,this.startTime=e+this.delayTime,0===this.#e.length&&Object.keys(this.#i).forEach((t=>{this.#c[t]=this.object[t],this.#e.push(t,this.#i[t])})),0===this.durationMS&&0===this.#s&&0===this.delayTime?(this.update(e),this.isPlaying=!1):s||(i.add(this),t.triggerAnimation()),this}start(...t){const i=this.#n;return new Promise((e=>{this.#n=()=>{i&&i(),this.#n=i,e(this)},this.startTween(...t)}))}stop(){return this.isPlaying?(this.isPlaying=!1,i.remove(this),this):this}delay(t){return this.delayTime=1e3*t,this}easing(t=(t=>t),{iterations:e=i.bezierIterations,cacheSize:s=i.bezierCacheSize}={}){let l=t;return l?("string"==typeof l&&(l=i.getEasingFromCache(l),e&&l.setIterations(e),s&&l.setCacheSize(s)),l.get?this.easingFunction=l.get.bind(l):this.easingFunction=l,this):this}onStart(t){return this.#o=t,this}onUpdate(t){return this.#t=t,this}onComplete(t=null){return this.#n=t,this}onTimelineIn(t){return this.onTimelineInCallback=t,this}onTimelineOut(t){return this.onTimelineOutCallback=t,this}onTimelineVisible(t){return this.onTimelineVisibleCallback=t,this}onTimelineInvisible(t){return this.onTimelineInvisibleCallback=t,this}updateAllValues(t=0){if(this.value!==this.#b){for(let t=0;t<this.#e.length;t+=2)this.#p(this.#e[t],this.#e[t+1]);null!==this.#t&&this.#t(this.object,this.value,t),this.#b=this.value}}invalidate(){return this.#b=null,this}#p(t,i){const e=this.#c[t];this.object[t]=e+(i-e)*this.value}update(i){if(i<this.startTime)return!0;!1===this.#h&&(null!==this.#o&&this.#o(this.object),this.#h=!0,t.trigger()),this.#r=i-this.startTime;const e=0===this.durationMS?1:Math.min(this.#r/this.durationMS,1);this.value=this.easingFunction(e),null===this.#u&&(this.#u=i);const s=i-this.#u;if(this.#u=i,this.updateAllValues(s),1===e){const t=this.startTime;return this.#l>0?(this.#a&&this.#a(this.object,this.#s-this.#l),this.#l--,this.restart()):this.#n&&this.isPlaying&&this.#n(this.object,i-this.startTime),this.isPlaying=!(t===this.startTime),!1}return!0}}export{e as default};
