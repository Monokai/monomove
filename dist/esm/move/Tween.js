import t from"./RenderLoop.js";import i from"./TweenManager.js";class e{durationMS=null;isPlaying=null;delayTime=null;startTime=null;easingFunction=null;object=null;value=null;onTimelineInCallback=null;onTimelineOutCallback=null;onTimelineVisibleCallback=null;onTimelineInvisibleCallback=null;#t;#i;#e;#l;#s;#a;#n;#o;#h;#u;#r;#c;#d;constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;"function"==typeof t&&void 0!==i?(this.object={value:0},this.#t=t,this.#i={value:1},this.durationMS=1e3*i,this.#c={value:0},this.#e=["value",this.#i.value]):(this.object=t,this.#i={},this.#t=null,this.durationMS=1e3,this.#c={},this.#e=[]),this.easingFunction=t=>t,this.value=0,this.delayTime=0,this.isPlaying=!1,this.startTime=null,this.onTimelineInCallback=null,this.onTimelineOutCallback=null,this.onTimelineVisibleCallback=null,this.onTimelineInvisibleCallback=null,this.#l=0,this.#s=0,this.#a=null,this.#n=null,this.#o=null,this.#h=!1,this.#u=null,this.#r=0,this.#d=null,Object.keys(this.object).forEach((t=>{this.#c[t]=this.object[t]}))}from(t){return Object.keys(t).forEach((i=>{this.object[i]=t[i]})),null!==this.#t&&this.#t(this.object,this.value,0),this}to(t,i){return void 0!==i&&(this.durationMS=1e3*i),this.#i=t,this.#e.length=0,this}duration(t){return this.durationMS=1e3*t,this}rewind(){return Object.keys(this.object).forEach((t=>{this.object[t]=this.#c[t]})),this.value=this.easingFunction(0),this}restart(){return this.rewind().start()}loop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return this.#l=t,this.#s=t,this}#b(t){return this.#a=t,this}startTween(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getTime();const l=this.isPlaying;return this.#r=0,this.#h=!1,this.isPlaying=!0,this.startTime=e+this.delayTime,0===this.#e.length&&Object.keys(this.#i).forEach((t=>{this.#c[t]=this.object[t],this.#e.push(t,this.#i[t])})),0===this.durationMS&&0===this.#l&&0===this.delayTime?(this.update(e),this.isPlaying=!1):l||(i.add(this),t.play()),this}start(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];const l=this.#n;return new Promise((t=>{this.#n=()=>{l&&l(),this.#n=l,t(this)},this.startTween(...i)}))}stop(){return this.isPlaying?(this.isPlaying=!1,i.remove(this),this):this}delay(t){return this.delayTime=1e3*t,this}easing(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>t,{iterations:e=i.bezierIterations,cacheSize:l=i.bezierCacheSize}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t;return s?("string"==typeof s&&(s=i.getEasingFromCache(s),e&&s.setIterations(e),l&&s.setCacheSize(l)),s.get?this.easingFunction=s.get.bind(s):this.easingFunction=s,this):this}onStart(t){return this.#o=t,this}onUpdate(t){return this.#t=t,this}onComplete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.#n=t,this}onTimelineIn(t){return this.onTimelineInCallback=t,this}onTimelineOut(t){return this.onTimelineOutCallback=t,this}onTimelineVisible(t){return this.onTimelineVisibleCallback=t,this}onTimelineInvisible(t){return this.onTimelineInvisibleCallback=t,this}updateAllValues(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.value!==this.#d){for(let t=0;t<this.#e.length;t+=2)this.#p(this.#e[t],this.#e[t+1]);null!==this.#t&&this.#t(this.object,this.value,t),this.#d=this.value}}invalidate(){return this.#d=null,this}#p(t,i){const e=this.#c[t];this.object[t]=e+(i-e)*this.value}update(i){if(i<this.startTime)return!0;!1===this.#h&&(null!==this.#o&&this.#o(this.object),this.#h=!0,t.trigger()),this.#r=i-this.startTime;const e=0===this.durationMS?1:Math.min(this.#r/this.durationMS,1);this.value=this.easingFunction(e),null===this.#u&&(this.#u=i);const l=i-this.#u;if(this.#u=i,this.updateAllValues(l),1===e){const t=this.startTime;return this.#s>0?(this.#a&&this.#a(this.object,this.#l-this.#s),this.#s--,this.restart()):this.#n&&this.isPlaying&&this.#n(this.object,i-this.startTime),this.isPlaying=!(t===this.startTime),!1}return!0}}export{e as default};
