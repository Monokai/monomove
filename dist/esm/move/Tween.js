import{classPrivateMethodInitSpec as t,defineProperty as i,classPrivateFieldInitSpec as e,classPrivateFieldSet as s,classPrivateFieldGet as h,classPrivateMethodGet as a}from"../_virtual/_rollupPluginBabelHelpers.js";import l from"./RenderLoop.js";import n from"./TweenManager.js";var r=new WeakMap,o=new WeakMap,u=new WeakMap,v=new WeakMap,d=new WeakMap,c=new WeakMap,w=new WeakMap,b=new WeakMap,g=new WeakMap,p=new WeakMap,m=new WeakMap,M=new WeakMap,k=new WeakMap,y=new WeakMap,j=new WeakMap,T=new WeakMap,f=new WeakMap,W=new WeakSet,P=new WeakSet;class S{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t(this,P),t(this,W),i(this,"durationMS",null),i(this,"isPlaying",null),i(this,"delayTime",null),i(this,"startTime",null),i(this,"easingFunction",null),i(this,"object",null),i(this,"value",null),e(this,r,{writable:!0,value:void 0}),e(this,o,{writable:!0,value:void 0}),e(this,u,{writable:!0,value:void 0}),e(this,v,{writable:!0,value:void 0}),e(this,d,{writable:!0,value:void 0}),e(this,c,{writable:!0,value:void 0}),e(this,w,{writable:!0,value:void 0}),e(this,b,{writable:!0,value:void 0}),e(this,g,{writable:!0,value:void 0}),e(this,p,{writable:!0,value:void 0}),e(this,m,{writable:!0,value:void 0}),e(this,M,{writable:!0,value:void 0}),e(this,k,{writable:!0,value:void 0}),e(this,y,{writable:!0,value:void 0}),e(this,j,{writable:!0,value:void 0}),e(this,T,{writable:!0,value:void 0}),e(this,f,{writable:!0,value:void 0}),"function"==typeof a&&void 0!==l?(this.object={value:0},s(this,r,a),s(this,o,{value:1}),this.durationMS=1e3*l):(this.object=a,s(this,o,{}),s(this,r,null),this.durationMS=1e3),s(this,v,0),s(this,d,0),s(this,c,null),s(this,w,null),s(this,b,null),s(this,g,!1),s(this,p,null),s(this,m,null),s(this,M,null),s(this,k,null),s(this,y,null),s(this,j,0),s(this,T,{}),s(this,u,[]),s(this,f,null),this.easingFunction=t=>t,this.value=0,this.delayTime=0,this.isPlaying=!1,this.startTime=null,Object.keys(this.object).forEach((t=>{h(this,T)[t]=this.object[t]}))}from(t){return Object.keys(t).forEach((i=>{this.object[i]=t[i]})),null!==h(this,r)&&h(this,r).call(this,this.object,this.value,0),this}to(t,i){return void 0!==i&&(this.durationMS=1e3*i),s(this,o,t),h(this,u).length=0,this}duration(t){return this.durationMS=1e3*t,this}rewind(){return Object.keys(this.object).forEach((t=>{this.object[t]=h(this,T)[t]})),this.value=this.easingFunction(0),this}restart(){return this.rewind().start()}loop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return s(this,v,t),s(this,d,t),this}startTween(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.getTime();const i=this.isPlaying;return s(this,j,0),s(this,g,!1),this.isPlaying=!0,this.startTime=t+this.delayTime,0===h(this,u).length&&Object.keys(h(this,o)).forEach((t=>{h(this,T)[t]=this.object[t],h(this,u).push(t,h(this,o)[t])})),0===this.durationMS&&0===h(this,v)&&0===this.delayTime?(this.update(t),this.isPlaying=!1):i||(n.add(this),l.trigger()),this}start(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];const a=h(this,w);return new Promise((t=>{s(this,w,(()=>{a&&a(),t(this)})),this.startTween(...i)}))}stop(){return this.isPlaying?(this.isPlaying=!1,n.remove(this),this):this}delay(t){return this.delayTime=1e3*t,this}easing(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>t,{iterations:i=n.bezierIterations,cacheSize:e=n.bezierCacheSize}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t;return s?("string"==typeof s&&(s=n.getEasingFromCache(s),i&&s.setIterations(i),e&&s.setCacheSize(e)),s.get?this.easingFunction=s.get.bind(s):this.easingFunction=s,this):this}onStart(t){return s(this,b,t),this}onUpdate(t){return s(this,r,t),this}onComplete(){return s(this,w,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this}onTimelineIn(t){return s(this,p,t),this}onTimelineOut(t){return s(this,m,t),this}onTimelineVisible(t){return s(this,M,t),this}onTimelineInvisible(t){return s(this,k,t),this}updateAllValues(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.value!==h(this,f)){for(let t=0;t<h(this,u).length;t+=2)a(this,P,F).call(this,h(this,u)[t],h(this,u)[t+1]);null!==h(this,r)&&h(this,r).call(this,this.object,this.value,t),s(this,f,this.value)}}invalidate(){return s(this,f,null),this}update(t){if(t<this.startTime)return!0;!1===h(this,g)&&(null!==h(this,b)&&h(this,b).call(this,this.object),s(this,g,!0),l.trigger()),s(this,j,t-this.startTime);const i=0===this.durationMS?1:Math.min(h(this,j)/this.durationMS,1);this.value=this.easingFunction(i),null===h(this,y)&&s(this,y,t);const e=t-h(this,y);if(s(this,y,t),this.updateAllValues(e),1===i){const i=this.startTime;var a;return h(this,d)>0?(h(this,c)&&h(this,c).call(this,this.object,h(this,v)-h(this,d)),s(this,d,(a=h(this,d),--a)),this.restart()):h(this,w)&&this.isPlaying&&h(this,w).call(this,this.object,t-this.startTime),this.isPlaying=!(i===this.startTime),!1}return!0}}function F(t,i){const e=h(this,T)[t];this.object[t]=e+(i-e)*this.value}export{S as default};
